import 'dart:io';

import '../scan_type.dart';
import 'base_view_model.dart';

class ScanPrediction {
  const ScanPrediction({required this.label, required this.confidence});

  final String label;
  final double confidence;
}

class ScanResultViewModel extends BaseViewModel {
  ScanResultViewModel({required this.scanType, required this.imageFile}) {
    _hydrateResultData();
  }

  final ScanType scanType;
  final File imageFile;

  late final List<ScanPrediction> _predictions;
  late final String _detailsTitle;
  late final String _summaryText;

  List<ScanPrediction> get predictions => _predictions;
  String get detailsTitle => _detailsTitle;
  String get summaryText => _summaryText;

  ScanPrediction get topPrediction => _predictions.first;

  String get topConfidencePercent =>
      (topPrediction.confidence * 100).toStringAsFixed(1);

  String get advisoryText => scanType == ScanType.skinDisease
      ? 'Your pet looks healthy. (${topPrediction.label} – '
            '$topConfidencePercent%)\n$summaryText'
      : 'Your pet’s breed is most likely ${topPrediction.label} '
            '($topConfidencePercent%).\n$summaryText';

  String get warningText =>
      'This result is generated by an AI model and may not be 100% accurate. '
      'It is not a medical diagnosis. Please consult a veterinarian for '
      'professional advice if you have any concerns about your pet’s health.';

  void _hydrateResultData() {
    if (scanType == ScanType.skinDisease) {
      _detailsTitle = 'Disease details';
      _predictions = const [
        ScanPrediction(label: 'Healthy skin', confidence: 0.98),
        ScanPrediction(label: 'Mild irritation', confidence: 0.02),
      ];
      _summaryText =
          'From this photo, your pet’s skin looks mostly healthy. If you notice '
          'redness, swelling or your pet seems uncomfortable, please consult a '
          'veterinarian.';
    } else {
      _detailsTitle = 'Breed result';
      _predictions = const [
        ScanPrediction(label: 'Domestic Shorthair', confidence: 0.72),
        ScanPrediction(label: 'Other / Mixed breed', confidence: 0.28),
      ];
      _summaryText =
          'From this photo, your pet’s breed is most likely Domestic '
          'Shorthair. This is an estimate and may not be exact, especially for '
          'mixed-breed pets.';
    }
  }
}
